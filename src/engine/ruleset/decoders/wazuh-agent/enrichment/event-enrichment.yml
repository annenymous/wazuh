---
name: decoder/agent-event-enrichment/0

sources:
  - decoder/json/0
  - decoder/queue-localfile/0
  - decoder/queue-syslog/0
  - decoder/syslog/0

metadata:
  title: Wazuh agent events enrichment
  description: It enriches events coming from a Wazuh agent with information related to it
  compatibility: >
    This decoder has been tested on Wazuh version 4.3
  author:
    name: Wazuh, Inc.
    date: 2022/01/09

check:
  - agent.id: +ef_exists

normalize:
  - map:
      - host.id: $agent.id
      - ~kvdb_host: +kvdb_get/agents_host_data/$agent.id

  - check:
      - ~kvdb_host: +ef_exists
    map:
    # TODO: KVDB host data must be processed before merging
      - host: +ef_merge_r/$~kvdb_host
