---
name: decoder/kvdb-agent-update/0

sources:
  - decoder/dbsync/0
  - decoder/dbsync-host-data/0
  - decoder/syscollector-dbsync-network-address-inserted/0
  - decoder/syscollector-dbsync-network-address/0
  - decoder/syscollector-dbsync-network-iface-inserted/0
  - decoder/syscollector-dbsync-network-iface/0
  - decoder/syscollector-dbsync-osinfo-inserted/0
  - decoder/syscollector-dbsync-osinfo/0
  - decoder/syscollector-network-ip/0
  - decoder/syscollector-network/0
  - decoder/syscollector-osinfo/0
  - decoder/syscollector-port-del/0
  - decoder/syscollector-port-save/0

metadata:
  title: Wazuh agent kvdb data update
  description: It updates the Wazuh agent data stored on the KVDB which is then used to enrich the events
  compatibility: >
    This decoder has been tested on Wazuh version 4.3
  author:
    name: Wazuh, Inc.
    date: 2022/01/09

check:
  - ~do_update_kvdb: +t_is_true

normalize:
  - map:
      - ~kvdb_update_result: +kvdb_set/$~agents_kvdb_name/$agent.id/$host
